<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/ionic.css"/>
    <link rel="stylesheet" type="text/css" href="css/all.css"/>
    <link rel="stylesheet" type="text/css" href="css/person.css"/>
    <script src="js/ionic.bundle.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="css/other.css">
    <style type="text/css">

    </style>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=72QwzLvIzM9Y2NAGEpGa7ZSDf3iMTRGG"></script>
    <script src="js/mapCtrl.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>

</head>
<body ng-controller="mapCtrl" style="position: relative">
<div style="width: 100%;height: 100%;position: relative">

    <div id="allmap" style="width: 100%;height: 100%">
    </div>

</div>
<div id="test2"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 10em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="closeBox1()"></a>
        </div>
        <div style="background-color: #484848;margin:0 auto;width: 95%">
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput2">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: #FFFFFF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-left-radius: 0.5em;border-bottom-left-radius:
                            0.5em;"><span></span></li>
                    <li
                            style="float: left;background-color:#F53D1B;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                    ><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color:#FEEB0C;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative">
                        <span></span></li>
                    <li
                            style="float: left;background-color: #0FB416;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #2381FD;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #9962FC;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #F930BF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-right-radius: 0.5em;border-bottom-right-radius:
                            0.5em;"><span></span></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-calm" style="width: 90%" id="create" onclick="createMarker()">确定
            </button>
            <!--<button class="button button-calm"-->
            <!--onclick="createPoint()">确定-->
            <!--</button>--></div>
    </div>
</div>
<div id="test3"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 3em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="closeBox3()"></a>
        </div>
        <div style="background-color: #484848;margin:0 auto;width: 95%">
            <div id="allmap2" style="width: 100%;height: 20em">
            </div>
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput3">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: #FFFFFF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-left-radius: 0.5em;border-bottom-left-radius:
                            0.5em;" onclick="changeColor(this)"><span></span></li>
                    <li onclick="changeColor(this)"
                            style="float: left;background-color:#F53D1B;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                    ><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color:#FEEB0C;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative">
                        <span></span></li>
                    <li
                            style="float: left;background-color: #0FB416;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #2381FD;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #9962FC;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #F930BF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-right-radius: 0.5em;border-bottom-right-radius:
                            0.5em;"><span></span></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-calm" style="width: 90%" id="create3" onclick="confirm()">确定
            </button>
            <!--<button class="button button-calm"-->
            <!--onclick="createPoint()">确定-->
            <!--</button>--></div>
    </div>
</div>
<div id="test"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 10em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="cancel()"></a>
        </div>
        <div style="background-color:#484848;margin:0 auto;width: 95%">
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle2"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: red;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                            onclick="getColor(this)"><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color: blue;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                            onclick="getColor(this)"><span></span></li>
                    <li
                            style="float: left;background-color: green;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-stable" onclick="remove()">删除</button>
            <button class="button button-calm"
                    onclick="confirm()">确定
            </button>
        </div>
    </div>
</div>
<div id="loading" style="position: absolute;top:50%;left:25%;text-align: center;background-color: white;font-size: 2em">
    地图加载中，请稍后...
</div>
<ion-footer-bar align-title="left" style="background-color: white;: 0">
    <button class="button button-full button-light "
            style="width: 50%;float: left;margin-top: 0;margin-bottom: 0" onclick="screenshot()"><i class="icon ion-image "
                                                                             style="color: #0A9DC7 "></i> 截图
    </button>
    <button class="button button-full button-light"
            style="width: 50%;float: left;margin-top: 0;margin-bottom: 0"><i class="icon ion-android-camera "
                                                                             style="color: #0A9DC7 "></i> 拍照
    </button>
</ion-footer-bar>

</body>
</html>
<script type="text/javascript">

    var map = new BMap.Map("allmap", {enableMapClick: false});
    var point = new BMap.Point(116.404, 39.915);
    map.centerAndZoom(point, 15);
    map.enableScrollWheelZoom(true);
    map.addEventListener('click', showBox1);
    map.addEventListener("tilesloaded", function () {
        document.getElementById("loading").innerText = "地图加载完成";
        setTimeout(function () {
            document.getElementById("loading").style.display = "none";
        }, 1000);
        console.log('over', map.getOverlays());
        //map.addEventListener('click', showBox1);
    });
    var marker, lng, lat,color='red';
    function showBox1(e) {
        if (map.getOverlays().length > 0)
            console.log('getOverlays',map.getOverlays());
        else {
            //document.getElementById("test2").style.display = "block";
            lng = e.point.lng;
            lat = e.point.lat;
            createMarker();
            console.log('else');
        }
    }
    function closeBox1() {
        document.getElementById("test2").style.display = "none";
    }
    function closeBox3() {
        document.getElementById("test3").style.display = "none";
    }
    function initMarker(lng,lat,color,words,mapc){
        var marker1 = new BMap.Marker(new BMap.Point(lng, lat), {
            icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                scale: 10,
                fillColor: color,
                fillOpacity: 1,
                strokeColor: color
            })
        });
        marker1.enableDragging();
        var label = new BMap.Label(words, {
            offset: new
            BMap.Size(20, -10)
        });
        label.setStyle({color: color, border: "0", fontWeight: "bold"});
        marker1.setLabel(label);
        marker=marker1;
        mapc.addOverlay(marker1);

    }
    function createMarker() {
        var newcolor='red'
//        var marker = new BMap.Marker(new BMap.Point(lng, lat), {
//            icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
//                scale: 10,
//                fillColor: newcolor,
//                fillOpacity: 1,
//                strokeColor: newcolor
//            })
//        });
//        marker.enableDragging();
        var labelInput = document.getElementById('labelInput2').value;
//        var label = new BMap.Label(labelInput, {
//            offset: new
//            BMap.Size(20, -10)
//        });
//        label.setStyle({color: newcolor, border: "0", fontWeight: "bold"});
//        marker.setLabel(label);
//        map.addOverlay(marker);
        //initMarker(lng, lat,"red",'',map);
        map.removeEventListener('click', showBox1);
        closeBox1();
        screenshot();
    }
    function screenshot(){
        document.getElementById("test3").style.display = "block";
        map2 = new BMap.Map("allmap2", {enableMapClick: false});
        if(map.getOverlays().length>0){
            var point2 = new BMap.Point(marker.point.lng, marker.point.lat);
        }
        else
            var point2 = new BMap.Point(lng, lat);
        //var point2 = new BMap.Point(marker.point.lng, marker.point.lat);
        map2.centerAndZoom(point2, 15);
        map2.enableScrollWheelZoom(true);
        console.log(marker);
        var marker2=marker;
        if(map.getOverlays().length>0){
            initMarker(marker.point.lng, marker.point.lat,'red','',map2);
            console.log('>0')
        }else
        {
        initMarker(lng, lat,'red','',map2);}
        console.log("map2",map2.getOverlays());

    }
    function confirm(){
        var labelInput = document.getElementById('labelInput3').value;
        map2.getOverlays();
        map.clearOverlays();
        map2.clearOverlays();
        initMarker(lng, lat,'red',labelInput,map);
        console.log('confirm');
        document.getElementById("test3").style.display = "none";
    }

</script>