<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/ionic.css"/>
    <link rel="stylesheet" type="text/css" href="css/all.css"/>
    <link rel="stylesheet" type="text/css" href="css/person.css"/>
    <script src="js/ionic.bundle.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="css/other.css">
    <style type="text/css">

    </style>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=72QwzLvIzM9Y2NAGEpGa7ZSDf3iMTRGG"></script>
    <script src="js/mapCtrl.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>

</head>
<body ng-controller="mapCtrl" style="position: relative">
<div style="width: 100%;height: 100%;position: relative">

    <div id="allmap" style="width: 100%;height: 100%">
    </div>

</div>
<div id="test2"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 10em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="closeBox1()"></a>
        </div>
        <div style="background-color: #484848;margin:0 auto;width: 95%">
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput2">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: #FFFFFF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-left-radius: 0.5em;border-bottom-left-radius:
                            0.5em;"><span></span></li>
                    <li
                            style="float: left;background-color:#F53D1B;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                    ><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color:#FEEB0C;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative">
                        <span></span></li>
                    <li
                            style="float: left;background-color: #0FB416;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #2381FD;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #9962FC;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #F930BF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-right-radius: 0.5em;border-bottom-right-radius:
                            0.5em;"><span></span></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-calm" style="width: 90%" id="create" onclick="createMarker()">确定
            </button>
            <!--<button class="button button-calm"-->
            <!--onclick="createPoint()">确定-->
            <!--</button>--></div>
    </div>
</div>
<div id="test3"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 3em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="closeBox3()"></a>
        </div>
        <div style="background-color: #484848;margin:0 auto;width: 95%">
            <div id="allmap2" style="width: 100%;height: 20em">
            </div>
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput3">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: #FFFFFF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-left-radius: 0.5em;border-bottom-left-radius:
                            0.5em;" ><span></span></li>
                    <li
                        style="float: left;background-color:#F53D1B;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                    ><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color:#FEEB0C;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative">
                        <span></span></li>
                    <li
                            style="float: left;background-color: #0FB416;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #2381FD;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #9962FC;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                    <li
                            style="float: left;background-color: #F930BF;width: 2.5em;height: 0.7em;margin: 0;padding:
                            0;border: 0;position: relative;border-top-right-radius: 0.5em;border-bottom-right-radius:
                            0.5em;"><span></span></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-calm" style="width: 90%" id="create3">确定
            </button>
            <!--<button class="button button-calm"-->
            <!--onclick="createPoint()">确定-->
            <!--</button>--></div>
    </div>
</div>
<div id="test"
     style="display: none;position: absolute;width: 100%;height: 100%;background: rgba(52, 52, 52, 0.5);z-index: 99;top:0"
     class="content has-header">

    <div style="border-radius: 5px;width: 90%;background-color: white;margin: 10em auto;">
        <div class="" style="text-align: right">
            <a class="button button-icon icon ion-ios-close-outline" style="color:gray;" onclick="cancel()"></a>
        </div>
        <div style="background-color:#484848;margin:0 auto;width: 95%">
            <div class="list" style="width: 90%;margin: 0 auto;padding-top: 2em">
                <label class="item item-input">
                    <input type="text" placeholder="请输入标签" id="labelInput">
                </label>
            </div>
            <div style="width: 90%;margin:1em auto;padding: 1em 0">
                <div style="display: inline-block;border-right: 1px solid whitesmoke">
                    <div
                            style="display: inline-block;border-radius: 1em;width: 2em;height: 2em;background-color: red;margin-right: 1em"
                            class="circle2"></div>
                    <span
                            style="font-size: 2.7em;color: whitesmoke;font-family:'Times New Roman';display: inline-block;margin-right: 1em ">T</span>
                </div>
                <ul
                        style="display: inline-block;padding-left: 1em" class="colorBar">
                    <li
                            style="float: left;background-color: red;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                            onclick="getColor(this)"><span class="testColor_red"></span></li>
                    <li
                            style="float: left;background-color: blue;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0;position: relative"
                            onclick="getColor(this)"><span></span></li>
                    <li
                            style="float: left;background-color: green;width: 2.5em;height: 0.7em;margin: 0;padding: 0;border: 0"></li>
                </ul>
            </div>
        </div>
        <div style="text-align: center;padding: 1em 0">
            <button class="button button-stable" onclick="remove()">删除</button>
            <button class="button button-calm"
                    onclick="confirm()">确定
            </button>
        </div>
    </div>
</div>
<div id="loading" style="position: absolute;top:50%;left:25%;text-align: center;background-color: white;font-size: 2em">
    地图加载中，请稍后...
</div>
<ion-footer-bar align-title="left" style="background-color: white;: 0">
    <button class="button button-full button-light "
            style="width: 50%;float: left;margin-top: 0;margin-bottom: 0" onclick="screenshot()"><i
            class="icon ion-image "
            style="color: #0A9DC7 "></i> 截图
    </button>
    <button class="button button-full button-light"
            style="width: 50%;float: left;margin-top: 0;margin-bottom: 0"><i class="icon ion-android-camera "
                                                                             style="color: #0A9DC7 "></i> 拍照
    </button>
</ion-footer-bar>

</body>
</html>
<script type="text/javascript">

    //创建大地图
    var map1 = new BMap.Map("allmap", {enableMapClick: false});
    var point = new BMap.Point(116.404, 39.915);
    map1.centerAndZoom(point, 15);
    map1.enableScrollWheelZoom(true);
    map1.addEventListener("tilesloaded", function () {
        document.getElementById("loading").innerText = "地图加载完成";
        setTimeout(function () {
            document.getElementById("loading").style.display = "none";
        }, 1000);
        console.log("地图加载完成");
        console.log('over', map1.getOverlays());
        console.log('overlength', map1.getOverlays().length);
    });
    map1.addEventListener('click', showBox1);
    function showBox1(e) {

        if (map1.getOverlays().length === 0) {
            console.log("length==0");
            console.log(e.point);
            document.getElementById("labelInput3").value="";
            document.getElementById("test3").style.display = "block";
            var map2 = new BMap.Map("allmap2", {enableMapClick: false});
            var point2 = new BMap.Point(e.point.lng, e.point.lat);
            map2.centerAndZoom(point2, 15);
            map2.enableScrollWheelZoom(false);
            map2.disableDragging();

            var color = 'red';
            var words = "";
            var marker = new BMap.Marker(new BMap.Point(e.point.lng, e.point.lat), {
                icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                    scale: 10,
                    fillColor: color,
                    fillOpacity: 1,
                    strokeColor: color
                })
            });
            var label = new BMap.Label(words, {
                offset: new
                BMap.Size(20, -10)
            });
            label.setStyle({color: color, border: "0", fontWeight: "bold"});
            marker.setLabel(label);
            console.log('marker', marker)
            map2.addOverlay(marker);
            console.log(map2.getOverlays());
            document.getElementById("labelInput3").addEventListener('keyup',print);
            function print(){
                var words=document.getElementById("labelInput3").value;
                map2.getOverlays()[0].getLabel().setContent(words);
            }
            document.getElementById('create3').addEventListener('click', confirm);

            $(".colorBar li").bind('click',changeColor);
            function changeColor(){

                var marker = new BMap.Marker(new BMap.Point(map2.getOverlays()[0].point.lng, map2.getOverlays()[0].point.lat), {
                    icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                        scale: 10,
                        fillColor: this.style.backgroundColor,
                        fillOpacity: 1,
                        strokeColor: this.style.backgroundColor
                    })
                });
                var label = new BMap.Label(map2.getOverlays()[0].getLabel().content, {
                    offset: new
                    BMap.Size(20, -10)
                });
                label.setStyle({color: this.style.backgroundColor, border: "0", fontWeight: "bold"});
                marker.setLabel(label);
                marker.enableDragging();
                map2.clearOverlays();
                map2.addOverlay(marker);

//                map2.getOverlays()[0].getLabel().setStyle({color:  this.style.backgroundColor});
//                console.log('colorbar',this.style.backgroundColor);
                $(".circle").css('background-color',this.style.backgroundColor);

            }
            function confirm() {
                console.log("showbox")
                closeBox3();

                var marker = new BMap.Marker(new BMap.Point(e.point.lng, e.point.lat), {
                    icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                        scale: 10,
                        fillColor: $(".circle").css('background-color'),
                        fillOpacity: 1,
                        strokeColor: $(".circle").css('background-color')
                    })
                });
                var label = new BMap.Label(map2.getOverlays()[0].getLabel().content, {
                    offset: new
                    BMap.Size(20, -10)
                });
                label.setStyle({color: $(".circle").css('background-color'), border: "0", fontWeight: "bold"});
                marker.setLabel(label);
                marker.enableDragging();
                map1.clearOverlays();
                map1.addOverlay(marker);
            }

            return map2.getOverlays();

        }

    }
    /**
     * 关闭截图窗口
     */
    function closeBox3() {
        document.getElementById("test3").style.display = "none";
    }
    function screenshot() {
        console.log('map1over',map1.getOverlays())
        {
            var a=map1.getOverlays()[0];
            console.log("length>0", map1.getOverlays().length, map1.getOverlays());
            //console.log(e.point);
            document.getElementById("test3").style.display = "block";
            document.getElementById("labelInput3").value=map1.getOverlays()[0].getLabel().content;
            var map3 = new BMap.Map("allmap2", {enableMapClick: false});
            var point3 = new BMap.Point(a.point.lng, a.point.lat);
            map3.centerAndZoom(point3, 15);
            map3.enableScrollWheelZoom(false);
            map3.disableDragging();
            console.log('a',a.getIcon().style.fillColor)
            var color = a.getIcon().style.fillColor;
            var words = 'test';
            var marker3 = new BMap.Marker(new BMap.Point(a.point.lng, a.point.lat), {
                icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                    scale: 10,
                    fillColor: color,
                    fillOpacity: 1,
                    strokeColor: color
                })
            });
            var label3 = new BMap.Label(map1.getOverlays()[0].getLabel().content, {
                offset: new
                BMap.Size(20, -10)
            });
            label3.setStyle({color: color, border: "0", fontWeight: "bold"});
            marker3.setLabel(label3);
            console.log('marker3', marker3)
            map3.addOverlay(marker3);
            console.log(map3.getOverlays());
            document.getElementById('create3').addEventListener('click', confirm2);
            document.getElementById("labelInput3").addEventListener('keyup',print);
            function print(){
                var words=document.getElementById("labelInput3").value;
                map3.getOverlays()[0].getLabel().setContent(words);
            }
            $(".colorBar li").bind('click',changeColor);
            function changeColor(){
                var color = map3.getOverlays()[0].getIcon().style.fillColor;
                var marker = new BMap.Marker(new BMap.Point(map3.getOverlays()[0].point.lng,
                    map3.getOverlays()[0].point.lat), {
                    icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                        scale: 10,
                        fillColor: this.style.backgroundColor,
                        fillOpacity: 1,
                        strokeColor: this.style.backgroundColor
                    })
                });
                var label = new BMap.Label(map3.getOverlays()[0].getLabel().content, {
                    offset: new
                    BMap.Size(20, -10)
                });
                label.setStyle({color: this.style.backgroundColor, border: "0", fontWeight: "bold"});
                marker.setLabel(label);
                marker.enableDragging();
                map3.clearOverlays();
                map3.addOverlay(marker);

//                map2.getOverlays()[0].getLabel().setStyle({color:  this.style.backgroundColor});
//                console.log('colorbar',this.style.backgroundColor);
                $(".circle").css('background-color',this.style.backgroundColor);

            }
            //map.getOverlays()[0].getLabel().setContent("hahah");
            function confirm2() {
                console.log("confirm2")
                closeBox3();
                var color = map3.getOverlays()[0].getIcon().style.fillColor;
                console.log( map1.getOverlays())
                var marker = new BMap.Marker(new BMap.Point(map3.getOverlays()[0].point.lng, map3.getOverlays()[0].point.lat), {
                    icon: new BMap.Symbol(BMap_Symbol_SHAPE_CIRCLE, {
                        scale: 10,
                        fillColor: color,
                        fillOpacity: 1,
                        strokeColor: color
                    })
                });
                var label = new BMap.Label(map3.getOverlays()[0].getLabel().content, {
                    offset: new
                    BMap.Size(20, -10)
                });
                label.setStyle({color: color, border: "0", fontWeight: "bold"});
                marker.setLabel(label);
                marker.enableDragging();
                map1.clearOverlays();
                map1.addOverlay(marker);
            }
        }
    }


</script>